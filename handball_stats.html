
<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Håndball – Enkel kampstatistikk</title>
  <style>
    :root{ --bg:#0b1220; --panel:#121a2b; --accent:#4cc9f0; --text:#e6f1ff; --muted:#9fb3c8; --bad:#ef476f; --ok:#06d6a0; --warn:#ffd166; --star:#ffd166; }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
    header{padding:12px 16px;background:linear-gradient(90deg,var(--panel),#0f1a33);display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px;flex:1}
    main{padding:16px;max-width:1100px;margin:auto}
    .grid{display:grid;gap:12px}
    @media(min-width:860px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--panel);border:1px solid #1f2a44;border-radius:12px;padding:12px}
    label{display:block;margin:8px 0 6px;color:var(--muted);font-size:13px}
    input[type="text"],input[type="number"],select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #2a3a5c;background:#0f1730;color:var(--text)}
    .btn{appearance:none;border:1px solid #244; background:#0f1730; color:#e6f1ff; padding:12px 14px; border-radius:10px; cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),#2895be); border-color:#1d6b87; color:#062231; font-weight:700}
    .btn.success{background:linear-gradient(180deg,var(--ok),#0ab77f); border-color:#0a8f66; color:#062231; font-weight:700}
    .btn.warn{background:linear-gradient(180deg,var(--warn),#e3b23b); border-color:#b9902f; color:#3d2b00; font-weight:700}
    .btn.danger{background:linear-gradient(180deg,var(--bad),#cc3557); border-color:#9c2a44; color:#33010f; font-weight:700}
    .btn.ghost{background:transparent;border-color:#2a3a5c}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .timer{font-variant-numeric:tabular-nums;font-size:40px;font-weight:800;letter-spacing:1px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:#0b1430;border:1px solid #2a3a5c;color:var(--muted);font-size:12px}
    /* Roster grid + badges */
    .roster-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px}
    .badge{padding:10px;border:1px solid #1f2a44;border-radius:12px;background:#0e1833;display:flex;flex-direction:column;gap:6px}
    .badge.active{outline:2px solid var(--accent);box-shadow:0 0 0 3px rgba(76,201,240,.2)}
    .badge .top{display:flex;align-items:center;gap:8px}
    .badge .nm{font-weight:700}
    .badge .starbtn{margin-left:auto}
    /* Player cards */
    .player-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
    .player{padding:12px;border:1px solid #1f2a44;border-radius:12px;background:#0e1833}
    .player h4{margin:0 0 6px 0; display:flex; align-items:center; gap:8px}
    .starbtn{border:none;background:transparent;padding:0;cursor:pointer;font-size:18px;line-height:18px;color:#2a3a5c}
    .starbtn.on{color:var(--star)}
    .actions{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:8px}
    .actions .btn{padding:16px 12px;font-size:15px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px solid #22324f}
    tr:hover{background:#0f1a35}
    .kpi{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .kpi .k{background:#0e1833;border:1px solid #1f2a44;border-radius:12px;padding:10px}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .sticky-footer{position:sticky;bottom:0;left:0;right:0;background:linear-gradient(180deg,rgba(11,18,32,0),var(--bg) 25%);padding:12px 0;margin-top:8px}
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#0e1833;border:1px solid #1f2a44;color:#e6f1ff;border-radius:12px;padding:10px 14px;z-index:2000;display:none;box-shadow:0 6px 24px rgba(0,0,0,.35)}
    .toast.show{display:block;animation:fadein .2s ease-out}
    @keyframes fadein{from{opacity:0;transform:translate(-50%,10px)}to{opacity:1;transform:translate(-50%,0)}}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:1000}
    .modal .content{width:min(800px,92vw);background:var(--panel);border:1px solid #1f2a44;border-radius:12px;padding:12px}
    .zone-wrap{width:100%}
    svg.zone{width:100%;height:auto;border-radius:20px;background:#7bb7da}
    .goal{fill:#0d4166}
    .nine{fill:none;stroke:#ffffff;stroke-dasharray:8 6;opacity:.9;vector-effect:non-scaling-stroke}
    .six{fill:none;stroke:#b11c4a;stroke-width:3;vector-effect:non-scaling-stroke}
    .numbtn circle{fill:rgba(0,0,0,0);stroke:rgba(0,0,0,0)}
    .numbtn:hover circle{fill:rgba(76,201,240,.12)}
    .numbtn.selected circle{fill:rgba(76,201,240,.55);stroke:var(--accent);stroke-width:2.5}
    .numbtn text{font-size:22px;fill:#fff;font-weight:800;text-anchor:middle;dominant-baseline:middle}
    .bar{height:12px;border-radius:999px;background:#0f1730;border:1px solid #2a3a5c;overflow:hidden}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--ok),#0ab77f)}
    .bar.bad > span{background:linear-gradient(90deg,var(--bad),#cc3557)}
  </style>
</head>
<body>
  <header>
    <h1>Håndball – Enkel kampstatistikk</h1>
  </header>

  <main>
    <section id="setup" class="grid grid-2">
      <div class="card">
        <h2 style="margin-top:0">1) Kampdetaljer</h2>

        <label>Konkurranse
          <select id="competition">
            <option value="Regional">Regional</option>
            <option value="Lokal">Lokal</option>
            <option value="Annet" selected>Annet</option>
          </select>
        </label>

        <label>Motstander (valgfritt)
          <input id="opponent" type="text" placeholder="Lag" />
        </label>

        <label>Merknader (valgfritt)
          <input id="notes" type="text" placeholder="Serie, treningskamp, osv." />
        </label>

        <div class="row" style="align-items:center;justify-content:space-between;margin-top:8px">
          <div style="flex:1">
            <label>Periodelengde (minutter)
              <input id="periodMinutes" type="number" min="1" max="60" value="30" />
            </label>
            <div class="small muted">Regional/Lokal: automatisk 25 min. Annet: valgfritt.</div>
          </div>
          <div><span class="pill">To omganger</span></div>
        </div>

        <div class="row" style="margin-top:8px">
          <button class="btn ghost" onclick="loadFromLocal()">Last inn sist lagret</button>
          <button class="btn ghost" onclick="clearLocal()">Tøm lokalt</button>
        </div>
      </div>

      <div class="card">
        <h2 style="margin-top:0">2) Velg spillere som deltar</h2>
        <div id="rosterList" class="roster-list"></div>
        <div class="row" style="margin-top:8px">
          <button class="btn success" onclick="markFieldPlayersAttending()">Marker alle utespillere</button>
          <button class="btn" onclick="selectNone()">Fjern deltakelse</button>
          <button class="btn ghost" onclick="markAllAttending()">Marker alle</button>
        </div>
      </div>

      <div class="card" style="grid-column:1/-1">
        <h2 style="margin-top:0">3) Start kamp</h2>
        <div class="row">
          <button class="btn primary" onclick="startGame()">Start kamp (til 1. omgang)</button>
          <button class="btn ghost" onclick="openSummary(true)">Vis pauseoppsummering</button>
        </div>
        <p class="small muted">Tips: du kan gå tilbake til oppsett før innsending.</p>
      </div>
    </section>

    <section id="ingame" style="display:none">
      <div class="grid grid-2">
        <div class="card">
          <div class="row" style="align-items:center;justify-content:space-between">
            <div>
              <div class="pill">Omgang <span id="periodLabel">1</span> / 2</div>
              <div class="timer" id="clock">00:00</div>
              <div class="small muted">Start/Stopp styrer klokken. Hendelser tidsstemples.</div>
            </div>
            <div class="grid" style="gap:8px;min-width:220px">
              <button id="btnStart" class="btn success" onclick="toggleClock()">Start</button>
              <button class="btn warn" onclick="endPeriod()">Avslutt omgang</button>
              <button class="btn ghost" onclick="openSummary(false)">Vis oppsummering</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="kpi">
            <div class="k"><div class="small muted">Mål</div><div id="kpiGoals" style="font-size:22px;font-weight:800">0</div></div>
            <div class="k"><div class="small muted">Assist</div><div id="kpiAssists" style="font-size:22px;font-weight:800">0</div></div>
            <div class="k"><div class="small muted">Bom</div><div id="kpiMiss" style="font-size:22px;font-weight:800">0</div></div>
            <div class="k"><div class="small muted">Redning</div><div id="kpiSaves" style="font-size:22px;font-weight:800">0</div></div>
            <div class="k"><div class="small muted">Baklengs</div><div id="kpiConceded" style="font-size:22px;font-weight:800">0</div></div>
            <div class="k"><div class="small muted">Hendelser</div><div id="kpiEvents" style="font-size:22px;font-weight:800">0</div></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Spillerhandlinger</h3>
        <div id="players" class="player-list"></div>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Hendelseslogg</h3>
        <div class="row" style="justify-content:flex-end;margin-bottom:8px">
          <button class="btn ghost" onclick="undoLast()">Angre siste</button>
          <button class="btn ghost" onclick="downloadCSV()">Last ned CSV</button>
        </div>
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Omgang</th>
                <th>Tid</th>
                <th>Spiller</th>
                <th>Rolle</th>
                <th>Hendelse</th>
                <th>Assist</th>
                <th>Sone</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="eventsBody"></tbody>
          </table>
        </div>
        <div class="sticky-footer row" style="justify-content:space-between">
          <div class="small muted">Data lagres lokalt til du sender inn.</div>
          <div class="row">
            <button class="btn" onclick="goBackToSetup()">Tilbake til oppsett</button>
            <button id="submitBtn" class="btn primary" onclick="submitToSheets()">Send inn kamp → Google-ark</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Summary Modal -->
  <div id="summaryModal" class="modal" role="dialog" aria-modal="true" aria-label="Oppsummering">
    <div class="content">
      <h3 style="margin-top:0">Oppsummering</h3>
      <div class="row" style="align-items:center;gap:10px">
        <label>Periode
          <select id="summaryPeriod" onchange="renderSummary()">
            <option value="1" selected>1. omgang</option>
            <option value="2">2. omgang</option>
            <option value="all">Hele kampen</option>
          </select>
        </label>
      </div>
      <div id="summaryBody" style="margin-top:8px"></div>
      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button class="btn" onclick="closeSummary()">Lukk</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ---------- Config ----------
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbznSnfDNQIVv-G4ILY5mhLrcKt6BgZ1Le0k08YlqEPrewh-JC9azb8Tfk-osxPDEBLn/exec";
    // New LS key to avoid stale/empty rosters from earlier versions:
    const LS_KEY = 'handball_stats_no_v22g';

    const DEFAULT_ROSTER = [
      { name:'Jacob', role:'Utespiller', star:false, attending:false },
      { name:'Patrick F', role:'Målvakt', star:false, attending:false },
      { name:'Jonas', role:'Utespiller', star:false, attending:false },
      { name:'Mats', role:'Utespiller', star:false, attending:false },
      { name:'Theodor', role:'Utespiller', star:false, attending:false },
      { name:'Ulrik', role:'Målvakt', star:false, attending:false },
      { name:'Loke', role:'Utespiller', star:false, attending:false },
      { name:'Sebastian', role:'Utespiller', star:false, attending:false },
      { name:'Mateo', role:'Utespiller', star:false, attending:false },
      { name:'Markus', role:'Utespiller', star:false, attending:false },
      { name:'Demyd', role:'Utespiller', star:false, attending:false },
      { name:'Theo', role:'Målvakt', star:false, attending:false },
      { name:'Stokka', role:'Utespiller', star:false, attending:false },
      { name:'Fabian', role:'Utespiller', star:false, attending:false },
      { name:'Nicolay', role:'Utespiller', star:false, attending:false },
      { name:'Felix', role:'Utespiller', star:false, attending:false },
      { name:'Ole', role:'Utespiller', star:false, attending:false },
      { name:'Patrick W.', role:'Utespiller', star:false, attending:false },
      { name:'Oskar', role:'Utespiller', star:false, attending:false },
      { name:'Adrian A', role:'Utespiller', star:false, attending:false },
      { name:'Adrian B', role:'Utespiller', star:false, attending:false }
    ];

    // ---------- State ----------
    const state = {
      metadata: { date: new Date().toISOString().slice(0,10), opponent: '', notes: '', competition: 'Annet', periodMinutes: 30 },
      players: [],
      currentPeriod: 1,
      clock: { running:false, startMs:0, elapsedMs:0, timerId:null },
      periodStarted: {1:false, 2:false},
      events: [],
      goalForm: { player:'', zone:null, assist:'' },
      missForm: { player:'', zone:null },
      concedeForm: { player:'', zone:null },
      saveForm: { player:'', zone:null },
      lastZoneByPlayer: {},
      editIndex: -1,
      editZone: null,
      submitting: false,
    };

    // ---------- Utils ----------
    const $ = (id) => document.getElementById(id);
    const escapeHtml = (s) => String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    const showToast = (msg) => { const t = $('toast'); if(!t) return; t.textContent = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1800); };

    const loadLocal = () => { try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : null; } catch { return null; } };
    const saveLocal = () => {
      try {
        const payload = { metadata: state.metadata, players: state.players, events: state.events, currentPeriod: state.currentPeriod, clock:{...state.clock, timerId:undefined} };
        localStorage.setItem(LS_KEY, JSON.stringify(payload));
      } catch (e) { console.warn('Could not save to localStorage', e); }
    };

    // ---------- Roster rendering ----------
    function renderRosterList() {
      const root = $('rosterList');
      if (!root) return;
      root.innerHTML = '';
      state.players.forEach((p) => {
        const div = document.createElement('div');
        div.className = 'badge' + (p.attending ? ' active' : '');
        div.innerHTML = `
          <div class="top">
            <span class="nm">${escapeHtml(p.name)}</span>
            <span class="small muted">${escapeHtml(p.role)}</span>
            <button class="starbtn ${p.star ? 'on':''}" title="Marker som nøkkelspiller" aria-label="Star">★</button>
          </div>
          <div class="row">
            <button class="btn ${p.attending ? 'success' : 'ghost'}" style="flex:1" aria-pressed="${p.attending}">
              ${p.attending ? 'Deltar' : 'Ikke deltar'}
            </button>
          </div>
        `;
        // Toggle attending
        div.querySelector('.btn').addEventListener('click', () => {
          p.attending = !p.attending;
          renderRosterList(); saveLocal();
        });
        // Toggle star
        div.querySelector('.starbtn').addEventListener('click', () => {
          p.star = !p.star;
          renderRosterList(); saveLocal();
        });
        root.appendChild(div);
      });
    }

    // ---------- Setup bindings ----------
    function bindSetupInputs() {
      const comp = $('competition');
      const opp = $('opponent');
      const notes = $('notes');
      const mins = $('periodMinutes');

      if (comp) comp.value = state.metadata.competition;
      if (opp) opp.value = state.metadata.opponent;
      if (notes) notes.value = state.metadata.notes;
      if (mins) mins.value = state.metadata.periodMinutes;

      comp?.addEventListener('change', onCompetitionChange);
      opp?.addEventListener('input', () => { state.metadata.opponent = opp.value; saveLocal(); });
      notes?.addEventListener('input', () => { state.metadata.notes = notes.value; saveLocal(); });
      mins?.addEventListener('input', () => {
        const v = parseInt(mins.value || '30', 10);
        state.metadata.periodMinutes = Number.isFinite(v) ? v : 30;
        saveLocal();
      });
    }

    function onCompetitionChange() {
      const sel = $('competition');
      const minutes = $('periodMinutes');
      if (!sel || !minutes) return;
      state.metadata.competition = sel.value;
      if (sel.value === 'Regional' || sel.value === 'Lokal') {
        minutes.value = 25;
        state.metadata.periodMinutes = 25;
        showToast('Periodelengde satt til 25 min for ' + sel.value);
      } else {
        state.metadata.periodMinutes = parseInt(minutes.value || '30', 10) || 30;
      }
      saveLocal();
    }

    // ---------- Roster actions ----------
    function markAllAttending() {
      state.players.forEach(p => p.attending = true);
      renderRosterList(); saveLocal();
    }
    function markFieldPlayersAttending() {
      state.players.forEach(p => p.attending = (p.role !== 'Målvakt'));
      renderRosterList(); saveLocal();
    }
    function selectNone() {
      state.players.forEach(p => p.attending = false);
      renderRosterList(); saveLocal();
    }

    // ---------- Game flow (basic timer so buttons work) ----------
    function startGame() {
      $('setup')?.setAttribute('style','display:none');
      $('ingame')?.setAttribute('style','display:block');
      $('periodLabel').textContent = state.currentPeriod;
      updateClockLabel(0);
      showToast('Kamp startet');
      saveLocal();
    }

    function toggleClock() {
      const btn = $('btnStart');
      if (!state.clock.running) {
        state.clock.running = true;
        state.clock.startMs = Date.now() - state.clock.elapsedMs;
        state.clock.timerId = setInterval(tickClock, 200);
        btn.textContent = 'Stopp';
        btn.classList.remove('success');
        btn.classList.add('danger');
      } else {
        state.clock.running = false;
        clearInterval(state.clock.timerId);
        state.clock.timerId = null;
        state.clock.elapsedMs = Date.now() - state.clock.startMs;
        btn.textContent = 'Start';
        btn.classList.remove('danger');
        btn.classList.add('success');
      }
      saveLocal();
    }

    function tickClock() {
      state.clock.elapsedMs = Date.now() - state.clock.startMs;
      updateClockLabel(state.clock.elapsedMs);
    }

    function updateClockLabel(ms) {
      const totalSec = Math.floor(ms / 1000);
      const mm = String(Math.floor(totalSec / 60)).padStart(2,'0');
      const ss = String(totalSec % 60).padStart(2,'0');
      $('clock').textContent = `${mm}:${ss}`;
    }

    function endPeriod() {
      if (state.clock.running) toggleClock();
      if (state.currentPeriod === 1) {
        state.currentPeriod = 2;
        $('periodLabel').textContent = '2';
        state.clock.elapsedMs = 0;
        updateClockLabel(0);
        showToast('2. omgang');
      } else {
        showToast('Kamp ferdig');
      }
      saveLocal();
    }

    // ---------- Events/log (placeholders so UI works) ----------
    function undoLast(){ showToast('Angre (ikke implementert)'); }
    function downloadCSV(){
      const rows = [
        ['#','Omgang','Tid','Spiller','Rolle','Hendelse','Assist','Sone'],
      ];
      const csv = rows.map(r => r.map(x => `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'events.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // ---------- Summary modal (placeholder) ----------
    function openSummary(){ $('summaryModal').style.display='flex'; renderSummary(); }
    function closeSummary(){ $('summaryModal').style.display='none'; }
    function renderSummary(){
      const el = $('summaryBody');
      el.innerHTML = `<div class="small muted">Oppsummering kommer her (ikke implementert).</div>`;
    }

    // ---------- Local storage actions ----------
    function loadFromLocal() {
      const data = loadLocal();
      if (!data) { showToast('Fant ingen lagrede data'); return; }
      state.metadata = { ...state.metadata, ...data.metadata };
      state.players = Array.isArray(data.players) && data.players.length ? data.players : DEFAULT_ROSTER.map(p=>({...p}));
      state.events = Array.isArray(data.events) ? data.events : [];
      state.currentPeriod = data.currentPeriod || 1;
      if (data.clock && typeof data.clock.elapsedMs === 'number') {
        state.clock.elapsedMs = data.clock.elapsedMs;
        updateClockLabel(state.clock.elapsedMs);
      }
      bindSetupInputs();
      renderRosterList();
      showToast('Lastet lagret data');
    }

    function clearLocal() {
      try { localStorage.removeItem(LS_KEY); } catch {}
      state.metadata = { date: new Date().toISOString().slice(0,10), opponent: '', notes: '', competition: 'Annet', periodMinutes: 30 };
      state.players = DEFAULT_ROSTER.map(p => ({...p}));
      state.events = [];
      state.currentPeriod = 1;
      state.clock = { running:false, startMs:0, elapsedMs:0, timerId:null };
      bindSetupInputs();
      renderRosterList();
      if ($('ingame').style.display !== 'none') updateClockLabel(0);
      showToast('Lokal lagring tømt');
    }

    // ---------- Submit to Google Apps Script ----------
    async function submitToSheets(){
      try {
        if(!GOOGLE_SCRIPT_URL){ alert('Mangler Google-URL.'); return; }
        if(state.submitting) return;
        state.submitting=true;
        const btn=$('submitBtn'); if(btn){ btn.disabled=true; btn.textContent='Sender...'; }
        const payload = { metadata: state.metadata, players: state.players, events: state.events };
        const blob = new Blob([JSON.stringify(payload)], {type:'application/json'});
        let sent = false;
        if('sendBeacon' in navigator){ try { sent = navigator.sendBeacon(GOOGLE_SCRIPT_URL, blob); } catch{} }
        if(!sent){
          try {
            const res = await fetch(GOOGLE_SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload), redirect:'follow', referrerPolicy:'no-referrer' });
            if(!res.ok) throw new Error('HTTP '+res.status);
          } catch(err){
            await fetch(GOOGLE_SCRIPT_URL, { method:'POST', mode:'no-cors', body: JSON.stringify(payload) });
          }
        }
        showToast('Kamp sendt!');
        clearLocal();
      } catch(err){
        console.error(err);
        alert('Nettverksfeil: '+err);
      } finally {
        state.submitting=false;
        const btn=$('submitBtn'); if(btn){ btn.disabled=false; btn.textContent='Send inn kamp → Google-ark'; }
      }
    }

    // ---------- Init ----------
    function init() {
      const data = loadLocal();
      if (data && Array.isArray(data.players) && data.players.length) {
        state.players = data.players;
        state.metadata = { ...state.metadata, ...data.metadata };
        state.events = Array.isArray(data.events) ? data.events : [];
        state.currentPeriod = data.currentPeriod || 1;
      } else {
        state.players = DEFAULT_ROSTER.map(p => ({...p}));
      }
      bindSetupInputs();
      renderRosterList();
      window.addEventListener('beforeunload', saveLocal);
    }

    document.addEventListener('DOMContentLoaded', init);

    // ---------- Expose for HTML onclick ----------
    window.markAllAttending = markAllAttending;
    window.markFieldPlayersAttending = markFieldPlayersAttending;
    window.selectNone = selectNone;
    window.onCompetitionChange = onCompetitionChange;
    window.loadFromLocal = loadFromLocal;
    window.clearLocal = clearLocal;
    window.startGame = startGame;
    window.toggleClock = toggleClock;
    window.endPeriod = endPeriod;
    window.goBackToSetup = function() {
      if (state.clock.running) toggleClock();
      $('ingame')?.setAttribute('style','display:none');
      $('setup')?.setAttribute('style','display:grid');
      saveLocal();
    };
    window.openSummary = openSummary;
    window.closeSummary = closeSummary;
    window.renderSummary = renderSummary;
    window.undoLast = undoLast;
    window.downloadCSV = downloadCSV;
    window.submitToSheets = submitToSheets;
  </script>
</body>
</html>
